# MKing Friend - 產品需求文檔 (PRD)

## 1. 產品概述

### 1.1 產品願景
MKing Friend 是一個以女性為主要服務對象的線上交友平台，旨在提供安全、友善的環境讓男女用戶根據共同興趣相互認識。

### 1.2 目標用戶
- **主要用戶**: 18-35歲女性，尋求高品質交友體驗
- **次要用戶**: 20-40歲男性，尊重平台規範的用戶

### 1.3 核心價值
- 以女性用戶體驗為設計中心
- 提供安全可靠的交友環境
- 支援多元化的互動方式
- 跨平台無縫使用體驗

## 2. 功能需求

### 2.1 用戶系統
#### 2.1.1 註冊與登入
- **多平台註冊**: Keycloak OAuth、Email、Line
- **身份驗證**: Email驗證、手機號碼驗證（可選）
- **安全機制**: 兩步驟驗證、密碼強度檢查

#### 2.1.2 個人資料管理
- **基本資訊**: 姓名、年齡、性別、位置、職業
- **興趣標籤**: 可選擇和自定義興趣標籤
- **隱私設定**: 資料可見性控制

### 2.2 多媒體功能
#### 2.2.1 內容上傳
- **照片**: 支援多張照片上傳，主照片設定
- **影片**: 短影片上傳（限制時長和大小）
- **音檔**: 語音自我介紹

#### 2.2.2 內容管理
- **編輯功能**: 照片裁切、濾鏡效果
- **隱私控制**: 內容可見性設定
- **審核機制**: 關鍵字過濾和人工內容審核 (AI功能為未來延伸)

### 2.3 社交互動
#### 2.3.1 基礎互動
- **按讚系統**: 對用戶或內容按讚
- **追蹤功能**: 關注感興趣的用戶
- **留言功能**: 在用戶內容下留言

#### 2.3.2 配對機制
- **智能推薦**: 基於興趣和行為的用戶推薦
- **篩選功能**: 年齡、位置、興趣等條件篩選
- **配對通知**: 互相按讚時的通知

### 2.4 即時通訊
#### 2.4.1 聊天功能
- **一對一聊天**: 私人聊天室
- **多媒體訊息**: 文字、圖片、語音、emoji
- **訊息狀態**: 已送達、已讀狀態顯示

#### 2.4.2 語音視頻通話
- **語音通話**: 好友間的即時語音通話
- **視頻通話**: 好友間的視頻通話
- **通話品質**: 自動調整通話品質

### 2.5 安全與隱私
#### 2.5.1 安全機制
- **用戶舉報**: 不當行為舉報系統
- **封鎖功能**: 封鎖特定用戶
- **內容審核**: 關鍵字過濾 + 人工審核機制 (AI功能為未來延伸)

#### 2.5.2 隱私保護
- **資料加密**: 所有敏感資料加密存儲
- **位置隱私**: 模糊位置顯示
- **聊天記錄**: 用戶可控制聊天記錄保存

### 2.6 後台管理系統
#### 2.6.1 核心管理功能
- **儀表板**: 系統概覽、關鍵指標、實時監控
- **用戶管理**: 用戶列表、詳細資料、狀態管理、行為分析
- **內容審核**: 用戶檔案審核、照片審核、聊天內容監控
- **舉報處理**: 舉報列表、處理流程、決策記錄
- **數據分析**: 用戶統計、配對分析、活躍度報告
- **系統監控**: 服務狀態、效能指標、錯誤日誌
- **權限管理**: 管理員角色、權限分配、操作審計
- **客服管理**: 客服工單、FAQ 管理、用戶反饋
- **系統配置**: 平台設置、功能開關、參數調整

#### 2.6.2 技術架構
- **前端**: React + TypeScript + Ant Design Pro
- **後端**: NestJS Admin Service + GraphQL
- **狀態管理**: Zustand + React Query
- **權限控制**: RBAC 模型 + JWT 認證
- **數據可視化**: ECharts + 自定義圖表組件

#### 2.6.3 安全要求
- **操作審計**: 所有管理操作記錄
- **IP 白名單**: 限制管理後台訪問來源
- **會話管理**: 自動登出、會話超時
- **數據脫敏**: 敏感資料展示脫敏
- **最小權限**: 按需分配管理權限

## 3. 非功能需求

### 3.1 效能需求
- **載入時間**: 頁面載入時間 < 3秒
- **API回應**: API回應時間 < 500ms
- **即時性**: 即時訊息延遲 < 100ms
- **併發性**: 支援1000+並發用戶

### 3.2 可用性需求
- **跨平台**: 支援手機、平板、電腦
- **瀏覽器**: 支援主流瀏覽器最新版本
- **離線功能**: 基本功能離線可用
- **可訪問性**: 符合WCAG 2.1 AA標準

### 3.3 安全需求
- **資料保護**: 符合GDPR和個資法要求
- **傳輸安全**: 全站HTTPS加密
- **認證安全**: OAuth 2.0標準
- **防護機制**: DDoS防護、SQL注入防護

## 4. 技術約束

### 4.1 技術棧選擇

#### 4.1.1 微服務架構
- **架構模式**: 微服務架構
- **API Gateway**: Nginx/Traefik (統一入口)
- **服務發現**: Consul
- **服務間通訊**: gRPC + RESTful API
- **負載均衡**: Nginx

#### 4.1.2 前端技術棧
- **框架**: React.js + TypeScript + Vite
- **狀態管理**: Zustand + React Query
- **UI 框架**: Ant Design + 自定義組件庫
- **地圖服務**: OpenStreetMap + Leaflet
- **測試**: Jest + React Testing Library

#### 4.1.3 後端技術棧
- **運行環境**: Node.js + NestJS + TypeScript
- **資料庫**: PostgreSQL (共享資料庫，微服務專用 Schema)
- **快取**: Redis
- **ORM**: Prisma
- **搜尋引擎**: Typesense
- **即時通訊**: Socket.io
- **測試**: Jest + Supertest

#### 4.1.4 部署與運維
- **容器化**: Docker + Docker Compose
- **編排**: Kubernetes (生產環境)
- **監控**: Prometheus + Grafana
- **日誌**: Loki + Promtail
- **錯誤追蹤**: Sentry (Self-hosted)

### 4.2 微服務架構設計

#### 4.2.1 核心微服務
- **API Gateway**: 統一入口，路由分發，認證授權
- **Auth Service**: 用戶認證，JWT 管理，OAuth 整合
- **User Service**: 用戶資料管理，個人檔案，偏好設置
- **Chat Service**: 即時聊天，訊息歷史，WebSocket 管理
- **Media Service**: 檔案上傳，圖片處理，CDN 管理
- **Search Service**: Typesense 整合，用戶搜尋，推薦演算法
- **Admin Service**: 後台管理，內容審核，數據統計

#### 4.2.2 基礎設施服務
- **服務發現**: Consul (服務註冊與發現)
- **負載均衡**: Nginx (反向代理與負載均衡)
- **配置管理**: 環境變數 + 配置中心
- **健康檢查**: 各服務健康狀態監控

### 4.3 第三方整合 (免費 Self-Hosted 方案)
- **認證服務**: Keycloak (開源身份認證服務)
- **檔案存儲**: MinIO (S3 兼容對象存儲)
- **推送通知**: Web Push API + Service Worker (瀏覽器原生)
- **分析服務**: Plausible Analytics (Self-hosted)
- **郵件服務**: Nodemailer + SMTP (開發環境使用 MailHog，生產環境建議使用 MailerSend)
- **監控服務**: Grafana + Prometheus (指標監控) + Loki + Promtail (日誌管理)
- **錯誤追蹤**: Sentry (Self-hosted)

## 5. 商業需求

### 5.1 商業模式
- **免費增值**: 基礎功能免費，進階功能付費
- **會員制**: 月費或年費會員
- **廣告收入**: 非侵入式廣告

### 5.2 成功指標
- **用戶增長**: 月活躍用戶數
- **用戶參與**: 日均使用時長
- **配對成功**: 成功配對數量
- **用戶滿意**: 用戶評分和反饋

## 6. 風險評估

### 6.1 技術風險
- **WebRTC複雜性**: 語音視頻功能技術難度高
- **擴展性**: 用戶增長時的系統擴展
- **安全漏洞**: 潛在的安全威脅

### 6.2 商業風險
- **競爭激烈**: 交友市場競爭激烈
- **用戶獲取**: 初期用戶獲取成本高
- **法規變化**: 相關法規可能變化

### 6.3 緩解策略
- **技術**: 使用成熟的開源解決方案
- **商業**: 專注差異化功能和用戶體驗
- **法規**: 持續關注法規變化，及時調整

## 7. 附錄

### 7.1 參考資料
- 競品分析報告
- 用戶調研結果
- 技術可行性分析

## 8. MVP 功能優先級

### 8.1 P0 - MVP 核心功能 (必須有)
- 用戶註冊/登入 (多平台支援)
- 個人檔案建立和管理
- 照片上傳和展示
- 用戶瀏覽和發現
- 按讚/不喜歡互動
- 配對通知機制
- 基礎即時聊天
- 響應式 UI 設計

### 8.2 P1 - MVP 增強功能 (強烈建議)
- 基礎搜尋和篩選
- 個人隱私設置
- 用戶舉報系統
- 基礎推薦演算法
- 訊息狀態顯示
- 基礎數據分析

### 8.3 P2 - 增強功能 (可延後)
- 多張照片上傳
- 地理位置搜尋
- 進階篩選選項
- 後台管理系統
- 多語言支援

### 8.4 P3 - 高級功能 (未來版本)
- 語音視頻通話
- AI 智能推薦
- 第三方平台整合
- 付費功能
- 移動應用

### 7.2 版本歷史
- v1.3 - 添加 MVP 功能優先級和後台管理系統需求 (2025-01-03)
- v1.2 - 更新微服務架構和技術棧 (2025-01-03)
- v1.1 - 添加 Typesense 搜尋引擎和 OpenStreetMap 地圖服務 (2025-01-03)
- v1.0 - 初始版本 (2025-01-02)